<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Fit exponential models to incidence data</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for fit {incidence}"><tr><td>fit {incidence}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Fit exponential models to incidence data</h2>

<h3>Description</h3>

<p>The function <code>fit</code> fits two exponential models to incidence data, of the
form: <i>log(y) = r * t + b</i> <br /> where 'y' is the incidence, 't' is time
(in days), 'r' is the growth rate, and 'b' is the origin. The function <code>fit</code>
will fit one model by default, but will fit two models on either side of a
splitting date (typically the peak of the epidemic) if the argument <code>split</code>
is provided. When groups are present, these are included in the model as main
effects and interactions with dates. The function <code>fit_optim_split()</code> can be
used to find the optimal 'splitting' date, defined as the one for which the
best average R2 of the two models is obtained. Plotting can be done using
<code>plot</code>, or added to an existing incidence plot by the piping-friendly
function <code>add_incidence_fit()</code>.
</p>


<h3>Usage</h3>

<pre>
fit(x, split = NULL, level = 0.95, quiet = FALSE)

fit_optim_split(
  x,
  window = x$timespan/4,
  plot = TRUE,
  quiet = TRUE,
  separate_split = TRUE
)

## S3 method for class 'incidence_fit'
print(x, ...)

## S3 method for class 'incidence_fit_list'
print(x, ...)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>x</code></td>
<td>
<p>An incidence object, generated by the function
<code><a href="incidence.html">incidence()</a></code>. For the plotting function, an <code>incidence_fit</code>
object.</p>
</td></tr>
<tr valign="top"><td><code>split</code></td>
<td>
<p>An optional time point identifying the separation between the
two models. If NULL, a single model is fitted. If provided, two models would
be fitted on the time periods on either side of the split.</p>
</td></tr>
<tr valign="top"><td><code>level</code></td>
<td>
<p>The confidence interval to be used for predictions; defaults to
95%.</p>
</td></tr>
<tr valign="top"><td><code>quiet</code></td>
<td>
<p>A logical indicating if warnings from <code>fit</code> should be
hidden; FALSE by default. Warnings typically indicate some zero incidence,
which are removed before performing the log-linear regression.</p>
</td></tr>
<tr valign="top"><td><code>window</code></td>
<td>
<p>The size, in days, of the time window either side of the
split.</p>
</td></tr>
<tr valign="top"><td><code>plot</code></td>
<td>
<p>A logical indicating whether a plot should be added to the
output (<code>TRUE</code>, default), showing the mean R2 for various splits.</p>
</td></tr>
<tr valign="top"><td><code>separate_split</code></td>
<td>
<p>If groups are present, should separate split dates be
determined for each group? Defaults to <code>TRUE</code>, in which separate split dates
and thus, separate models will be constructed for each group. When <code>FALSE</code>,
the split date will be determined from the pooled data and modelled with the
groups as main effects and interactions with date.</p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p>currently unused.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>For <code>fit()</code>, a list with the class <code>incidence_fit</code> (for a
single model), or a list containing two <code>incidence_fit</code> objects (when
fitting two models). <code>incidence_fit</code> objects contain:
</p>

<ul>
<li> <p><code style="white-space: pre;">$model</code>: the fitted linear model
</p>
</li>
<li> <p><code style="white-space: pre;">$info</code>: a list containing various information extracted from the model
(detailed further)
</p>
</li>
<li> <p><code style="white-space: pre;">$origin</code>: the date corresponding to day '0'
</p>
</li></ul>

<p>The <code style="white-space: pre;">$info</code> item is a list containing:
</p>

<ul>
<li> <p><code>r</code>: the growth rate
</p>
</li>
<li> <p><code>r.conf</code>: the confidence interval of 'r'
</p>
</li>
<li> <p><code>pred</code>: a <code>data.frame</code> containing predictions of the model,
including the true dates (<code>dates</code>), their numeric version used in the
model (<code>dates.x</code>), the predicted value (<code>fit</code>), and the lower
(<code>lwr</code>) and upper (<code>upr</code>) bounds of the associated confidence
interval.
</p>
</li>
<li> <p><code>doubling</code>: the predicted doubling time in days; exists only if 'r' is
positive
</p>
</li>
<li> <p><code>doubling.conf</code>: the confidence interval of the doubling time
</p>
</li>
<li> <p><code>halving</code>: the predicted halving time in days; exists only if 'r' is
negative
</p>
</li>
<li> <p><code>halving.conf</code>: the confidence interval of the halving time
</p>
</li></ul>

<p>For <code>fit_optim_split</code>, a list containing:
</p>

<ul>
<li> <p><code>df</code>: a <code>data.frame</code> of dates that were used in the optimization
procedure, and the corresponding average R2 of the resulting models.
</p>
</li>
<li> <p><code>split</code>: the optimal splitting date
</p>
</li>
<li> <p><code>fit</code>: an <code>incidence_fit_list</code> object containing the fit for each split.
If the <code>separate_split = TRUE</code>, then the <code>incidence_fit_list</code> object will
contain these splits nested within each group. All of the <code>incidence_fit</code>
objects can be retrieved with <code><a href="get_fit.html">get_fit()</a></code>.
</p>
</li>
<li> <p><code>plot</code>: a plot showing the content of <code>df</code> (ggplot2 object)
</p>
</li></ul>



<h3>Author(s)</h3>

<p>Thibaut Jombart <a href="mailto:thibautjombart@gmail.com">thibautjombart@gmail.com</a>, Zhian N. Kamvar
<a href="mailto:zkamvar@gmail.com">zkamvar@gmail.com</a>.
</p>


<h3>See Also</h3>

<p>the <code><a href="incidence.html">incidence()</a></code> function to generate the 'incidence'
objects. The <code><a href="get_fit.html">get_fit()</a></code> function to flatten <code>incidence_fit_list</code> objects to
a list of <code>incidence_fit</code> objects.
</p>


<h3>Examples</h3>

<pre>

if (require(outbreaks)) { withAutoprint({
 dat &lt;- ebola_sim$linelist$date_of_onset

 ## EXAMPLE WITH A SINGLE MODEL

 ## compute weekly incidence
 i.7 &lt;- incidence(dat, interval=7)
 plot(i.7)
 plot(i.7[1:20])

 ## fit a model on the first 20 weeks
 f &lt;- fit(i.7[1:20])
 f
 names(f)
 head(get_info(f, "pred"))

 ## plot model alone (not recommended)
 plot(f)

 ## plot data and model (recommended)
 plot(i.7, fit = f)
 plot(i.7[1:25], fit = f)

## piping versions
if (require(magrittr)) { withAutoprint({
  plot(i.7) %&gt;% add_incidence_fit(f)


  ## EXAMPLE WITH 2 PHASES
  ## specifying the peak manually
  f2 &lt;- fit(i.7, split = as.Date("2014-10-15"))
  f2
  plot(i.7) %&gt;% add_incidence_fit(f2)

  ## finding the best 'peak' date
  f3 &lt;- fit_optim_split(i.7)
  f3
  plot(i.7) %&gt;% add_incidence_fit(f3$fit)
})}

})}

</pre>

<hr /><div style="text-align: center;">[Package <em>incidence</em> version 1.7.1 <a href="00Index.html">Index</a>]</div>
</body></html>
